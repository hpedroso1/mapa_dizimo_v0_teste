<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Mapa de Doações TESTE – Aplicação Profissional</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* =========================================================================
       VARIÁVEIS DE COR E ESTILOS BÁSICOS
    ========================================================================= */
    :root {
      --dark-blue: #072745;
      --primary-color: #003057;
      --secondary-color: #00509e;
      --accent-color: #cce0ff;
      --bg-color: #f4f6f8;
      --white: #ffffff;
      --gold: #A18547;
      --box-shadow: 0 4px 16px rgba(0,0,0,0.10);
      --inf-offset: 40px;
      --tab-color-1: #002445;
      --tab-color-2: #003057;
      --tab-color-3: #00509e;
      --tab-color-4: #0066cc;
      --transition: 0.25s cubic-bezier(.4,0,.2,1);
      --radius: 16px;
      --font-main: 'Inter', 'Segoe UI', Arial, sans-serif;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      font-family: var(--font-main);
      background: var(--bg-color);
      color: #222;
      font-size: 17px;
      scroll-behavior: smooth;
      max-width: 100vw;
      overflow-x: hidden;
    }
    /* POP UP DE INSTRUÇÕES */
    #instructionModal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      transition: opacity var(--transition);
    }
    .instruction-content {
      background: var(--white);
      padding: 40px 32px 32px 32px;
      border-radius: var(--radius);
      width: 95%;
      max-width: 520px;
      text-align: center;
      box-shadow: var(--box-shadow);
      animation: popIn 0.5s cubic-bezier(.4,0,.2,1);
    }
    @keyframes popIn {
      from { transform: scale(0.85); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .instruction-content h2 {
      margin-bottom: 18px;
      color: var(--dark-blue);
      font-size: 1.7rem;
      font-weight: 700;
    }
    .instruction-content p, .instruction-content li {
      font-size: 1.08rem;
      color: var(--primary-color);
      line-height: 1.6;
    }
    .instruction-content ul {
      text-align: left;
      margin-bottom: 22px;
      line-height: 1.7;
      padding-left: 22px;
    }
    .instruction-content li {
      margin: 10px 0;
    }
    #closeInstructionBtn {
      background: #f8f6f2;
      border: 1.5px solid #B29637;
      color: #B29637;
      padding: 14px 32px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: normal;
      transition: all var(--transition);
      box-shadow: 0 2px 8px rgba(178, 150, 55, 0.1);
      letter-spacing: 0.5px;
    }
    #closeInstructionBtn:hover {
      background: #B29637;
      color: #f8f6f2;
      box-shadow: 0 4px 12px rgba(178, 150, 55, 0.2);
      transform: translateY(-1px);
    }
    /* HEADER UNIFICADO */
    .unified-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: var(--white);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 1100;
    }

    .header-top {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      padding: 8px 32px;
      height: 72px;
    }

    .logo-section img {
      height: 60px;
      width: auto;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.10));
    }

    .header-bottom {
      display: none;
    }

    .nav-container {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 16px;
    }
    
    .header-left {
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }
    
    .header-center {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .header-right {
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    .help-btn {
      background: #f8f6f2;
      border: 1.5px solid #B29637;
      color: #B29637;
      font-size: 0.9rem;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: normal;
      transition: all var(--transition);
      box-shadow: 0 2px 8px rgba(178, 150, 55, 0.1);
      outline: none;
      letter-spacing: 0.2px;
      font-family: var(--font-main);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .help-btn:hover {
      background: #B29637;
      color: #f8f6f2;
      box-shadow: 0 4px 12px rgba(178, 150, 55, 0.2);
      transform: translateY(-1px);
    }

    /* Menu Hambúrguer */
    .hamburger-menu {
      position: relative;
    }
    
    .hamburger-btn {
      background: #B29637;
      border: none;
      color: white;
       padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all var(--transition);
      display: flex;
       flex-direction: row;
       gap: 12px;
       width: auto;
       min-width: 80px;
      height: 50px;
       justify-content: space-between;
      align-items: center;
    }
    
    .hamburger-btn:hover {
      background: #9a7f2f;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(178, 150, 55, 0.3);
    }
    
     .hamburger-lines {
       display: flex;
       flex-direction: column;
       gap: 4px;
     }
    
     .hamburger-lines span {
      width: 20px;
      height: 2px;
      background: white;
      transition: all var(--transition);
      border-radius: 1px;
    }
    
     .hamburger-btn.active .hamburger-lines span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    
     .hamburger-btn.active .hamburger-lines span:nth-child(2) {
      opacity: 0;
    }
    
     .hamburger-btn.active .hamburger-lines span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }
    
     .menu-text {
       font-size: 0.9rem;
       font-weight: 500;
       color: white;
    }
    
    .hamburger-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border: 2px solid #B29637;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      min-width: 200px;
      z-index: 99999;
      display: none;
      flex-direction: column;
      overflow: hidden;
    }
    
    .hamburger-dropdown.show {
      display: flex;
      animation: slideDown 0.3s ease-out;
    }
    
    .hamburger-dropdown button {
      background: transparent;
      border: none;
      color: #B29637;
      padding: 12px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all var(--transition);
      font-weight: 500;
      text-align: left;
      border-bottom: 1px solid rgba(178, 150, 55, 0.1);
    }
    
    .hamburger-dropdown button:last-child {
      border-bottom: none;
    }
    
    .hamburger-dropdown button:hover {
      background: #B29637;
      color: white;
    }
    
    .hamburger-dropdown button.active {
      background: #B29637;
      color: white;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* MODAL DE INSTRUÇÕES */
    .instructions-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      animation: fadeIn 0.3s ease-out;
    }

    .instructions-modal.show {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .instructions-content {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .instructions-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px 32px;
      border-bottom: 1px solid #e0e0e0;
      background: linear-gradient(135deg, #B29637 0%, #c4a94a 100%);
      color: white;
      border-radius: 16px 16px 0 0;
    }

    .instructions-header h2 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .instructions-body {
      padding: 32px;
    }

    .instruction-section {
      margin-bottom: 24px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
      border-left: 4px solid var(--primary-color);
    }

    .instruction-section h3 {
      color: var(--primary-color);
      margin-bottom: 12px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .instruction-section p {
      color: #6c757d;
      line-height: 1.6;
      margin: 0;
    }

    .close-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition);
    }

    .close-btn:hover {
      background: #dc3545;
      transform: scale(1.1);
    }

    /* Modal de Carregamento */
    .loading-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10001;
    }

    .loading-content {
      background: white;
      border-radius: 16px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }

    .loading-spinner {
      margin-bottom: 20px;
    }

    .loading-content h3 {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 1.5rem;
    }

    .loading-content p {
      color: #6c757d;
      margin: 0;
    }

    .close-instructions-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-instructions-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .instructions-body {
      padding: 32px;
    }

    .instruction-section {
      margin-bottom: 32px;
    }

    .instruction-section:last-child {
      margin-bottom: 0;
    }

    .instruction-section h3 {
      color: #B29637;
      font-size: 1.2rem;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 8px;
    }

    .instruction-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .instruction-section li {
      margin-bottom: 12px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #B29637;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.3s ease;
    }

    .instruction-section li:hover {
      background: #e9ecef;
      transform: translateX(5px);
    }

    .instruction-section li i {
      color: #B29637;
      width: 20px;
      text-align: center;
    }
    .nav-right {
      display: flex;
      gap: 18px;
    }
    

    /* MAPA */
    #map {
      position: absolute;
      top: 72px; /* CORRIGIDO */
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1;
      transition: filter var(--transition);
      margin: 0;
      padding: 0;
    }
    /* SIDEBARS LATERAIS */
    .sidebar-left, .sidebar-right {
      position: fixed;
      top: 72px; /* CORRIGIDO */
      width: 340px;
      max-height: calc(100% - 200px);
      background: linear-gradient(135deg, #ffffff 80%, #f4f6f8 100%);
      border: 1.5px solid #e0e0e0;
      border-radius: var(--radius);
      padding: 26px 22px 22px 22px;
      margin: 0;
      box-shadow: var(--box-shadow);
      overflow-y: auto;
      z-index: 1000;
      transition: box-shadow var(--transition), border var(--transition);
    }

    /* SIDEBAR ESQUERDO COMO MENU LATERAL */
    .sidebar-left {
      position: fixed;
      top: 72px; /* CORRIGIDO */
      left: 0;
       width: 550px;
      height: calc(100vh - 72px); /* CORRIGIDO */
      max-height: calc(100vh - 72px); /* CORRIGIDO */
      border-radius: 0;
      border-left: none;
      border-top: none;
      border-bottom: none;
      border-right: 1.5px solid #e0e0e0;
      padding: 26px 22px 22px 22px;
      background: #F7F7F7;
      box-shadow: var(--box-shadow);
      overflow-y: auto;
       display: flex;
       flex-direction: column;
      z-index: 1000;
      transition: box-shadow var(--transition), border var(--transition);
    }
    
    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .view-table-btn {
      background: #003057;
      border: 1.5px solid #003057;
      color: white;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition);
    }
    
    .view-table-btn:hover {
      background: #00509e;
      border-color: #00509e;
      transform: scale(1.1);
    }

    /* OCULTAR SIDEBAR DIREITO COMPLETAMENTE */
     /* .sidebar-right removido - agora é controlado via JavaScript */

    /* CARD DE DETALHES DA ESCOLA NA DIREITA */
    .school-details-card-right {
      position: fixed;
      top: 72px; /* CORRIGIDO */
      right: 0;
      width: 340px;
      height: calc(100vh - 72px); /* CORRIGIDO */
      background: #F7F7F7;
      border-left: 1.5px solid #e0e0e0;
      box-shadow: -4px 0 16px rgba(0,0,0,0.1);
      z-index: 1000;
      display: none;
      overflow-y: auto;
      animation: slideInRight 0.3s ease-out;
    }

    .school-details-card-right.show {
      display: block;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    /* Ajustar o mapa para ficar ao lado do sidebar */
    #map {
      position: absolute;
      top: 72px; /* CORRIGIDO */
       left: 550px;
      right: 0;
      bottom: 0;
      z-index: 1;
      transition: filter var(--transition), left var(--transition), right var(--transition);
    }

    /* Classe para quando o sidebar direito estiver visível */
    #map.with-right-sidebar {
       left: 550px;
      right: 340px;
    }

    /* Garantir que o mapa ocupe toda a largura quando sidebar direito estiver oculto */
    #map:not(.with-right-sidebar) {
      right: 0 !important;
    }
    
    /* Ajustar posição do popup do Leaflet para não ser cortado */
    .leaflet-popup {
      margin-bottom: 50px !important;
    }
    
    .leaflet-popup-tip-container {
      bottom: -20px !important;
    }
    
    .leaflet-popup-content-wrapper {
      border-radius: 8px !important;
      padding: 10px !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    }
    
    .leaflet-popup-content {
      margin: 10px !important;
      line-height: 1.5 !important;
    }

    /* Remover qualquer espaço reservado para sidebar direito */
     /* Regra removida - sidebar direito agora é controlado via JavaScript */

    .sidebar-right {
      right: 32px;
    }
    .sidebar-left h2, .sidebar-right h2 {
      font-size: 1.18rem;
      color: var(--dark-blue);
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e0e0e0;
      font-weight: normal;
      letter-spacing: 0.2px;
    }
    /* ELEMENTOS INTERNOS DOS BOXES */
    .totals-card {
      display: flex;
      justify-content: space-around;
      background: linear-gradient(90deg, var(--primary-color) 60%, var(--secondary-color) 100%);
      border-radius: 12px;
      padding: 18px 0;
      margin-bottom: 18px;
      font-size: 1.13rem;
      color: #fff;
      font-weight: normal;
      box-shadow: 0 2px 8px rgba(0,48,87,0.08);
      gap: 12px;
    }
    .totals-card div i {
      margin-right: 7px;
      color: var(--gold);
      font-size: 1.2em;
    }
    .entities-list {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 15px 10px;
      margin-bottom: 18px;
      max-height: 280px;
      overflow-y: auto;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .entities-list .entity-item {
       padding: 6px 0;
       font-size: 0.95rem;
      border-bottom: 1px solid #ececec;
      transition: background var(--transition);
    }
    .entities-list .entity-item:last-child {
      border-bottom: none;
    }
    .entities-list .entity-item:hover {
      background: #eaeaea;
    }
    /* SIDEBAR DIREITA */
    #centralDetails {
      margin-bottom: 15px;
      font-size: 1.05rem;
      color: var(--dark-blue);
      font-weight: 600;
      padding: 10px 0;
      background: #f9fafc;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    #centraisList details {
      margin-bottom: 10px;
      padding: 8px 0;
      background: #fafafa;
      border-radius: 6px;
      transition: background var(--transition);
      box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    }
    #centraisList summary {
      cursor: pointer;
      font-weight: 700;
      font-size: 1.05rem;
      list-style: none;
      outline: none;
      padding: 4px 0 4px 2px;
    }
    #centraisList details[open] {
      background: #f0f8ff;
    }
    .central-item {
      padding: 8px 12px;
      cursor: pointer;
      font-size: 0.98rem;
      border-radius: 6px;
      transition: background var(--transition), color var(--transition);
      margin: 2px 0;
    }
    .central-item:hover {
      background: #e0efff;
      color: var(--primary-color);
    }
    .central-item.selected {
      background: #cce0ff;
      font-weight: bold;
      color: var(--primary-color);
    }
    .school-item {
      padding: 8px 12px;
      font-size: 1.05rem;
      cursor: pointer;
      border-radius: 6px;
      transition: background var(--transition), color var(--transition);
      margin: 2px 0;
    }
    .school-item:hover {
      background: #e0efff;
      color: var(--primary-color);
    }
    .school-item.selected {
      background: #cce0ff;
      font-weight: bold;
      color: var(--primary-color);
    }
    /* SEÇÃO DO GRÁFICO */
    #chartContainer {
      position: absolute;
      top: 72px; left: 0; right: 0; bottom: 0;
      display: none;
      z-index: 1000;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 40px;
    }
    
     /* Seção de Lista em Tela Cheia */
     #fullscreenListSection {
       position: fixed;
       top: 0;
       left: 0;
       width: 100vw;
       height: 100vh;
       background: rgba(0, 0, 0, 0.8);
       z-index: 9999;
       display: flex;
      align-items: center;
      justify-content: center;
     }
    
     .fullscreen-list-wrapper {
       background: white;
      width: 95vw;
       height: 95vh;
       border-radius: 8px;
       box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
       overflow: hidden;
     }
    
     .fullscreen-list-header {
       background: var(--primary-color);
       color: white;
       padding: 20px;
       display: flex;
       justify-content: space-between;
       align-items: center;
       flex-shrink: 0;
     }
    
     .fullscreen-list-header h2 {
       margin: 0;
       font-size: 1.5rem;
     }
    
     .close-fullscreen-btn {
       background: rgba(255, 255, 255, 0.2);
       color: white;
       border: none;
       border-radius: 50%;
       width: 40px;
       height: 40px;
       font-size: 1.5rem;
       cursor: pointer;
       display: flex;
       align-items: center;
       justify-content: center;
       transition: background var(--transition);
     }
    
     .close-fullscreen-btn:hover {
       background: rgba(255, 255, 255, 0.3);
     }
    
     .fullscreen-list-content {
       flex: 1;
       overflow: hidden;
       display: flex;
       flex-direction: column;
     }
    
     .fullscreen-list-container {
       flex: 1;
       overflow-y: auto;
       padding: 20px;
     }
    
     .fullscreen-list-container .entity-item {
       padding: 12px 0;
       font-size: 1rem;
       border-bottom: 1px solid #ececec;
       transition: background var(--transition);
     }
    
     .fullscreen-list-container .entity-item:hover {
       background: #f5f5f5;
    }
    #chartModal .close-modal {
      position: absolute;
      top: 12px; right: 12px;
      background: var(--primary-color);
      color: var(--white);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      transition: background var(--transition), transform var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
    }
    #chartModal .close-modal:hover {
      background: #dc3545;
      transform: scale(1.1);
    }
    
    .chart-background {
      position: relative;
      width: 100%;
      height: 100vh;
      min-height: calc(100vh - 72px);
    }
    
    .chart-bg-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }
    
    .chart-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 40px;
      display: flex;
      flex-direction: column;
    }
    
    .chart-title {
      text-align: center;
      font-size: 2.5rem;
      font-weight: bold;
      color: #042945;
      margin-bottom: 20px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .chart-subtitle {
      text-align: center;
      font-size: 1.2rem;
      color: #6c757d;
      margin-bottom: 40px;
    }
    
    #chartContainer canvas {
      flex: 1;
      max-height: calc(100% - 120px);
      background: transparent;
    }
    
    #chartModal canvas[style*="display: block"] {
      display: block !important;
    }
    
    /* MODAL DA TABELA */
    #dataTableModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    
    .table-modal {
      background: var(--white);
      padding: 24px;
      border-radius: var(--radius);
      width: 90vw;
      max-width: 1200px;
      height: 80vh;
      max-height: 700px;
      position: relative;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      animation: popIn 0.4s cubic-bezier(.4,0,.2,1);
      display: flex;
      flex-direction: column;
    }
    
    .table-modal h2 {
      color: var(--primary-color);
      margin-bottom: 20px;
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .table-container {
      flex: 1;
      overflow: auto;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
    }
    
    #dataTable {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    
    #dataTable th {
      background: var(--primary-color);
      color: white;
      padding: 12px 8px;
      text-align: left;
      font-weight: bold;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    #dataTable td {
      padding: 10px 8px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    #dataTable tbody tr:hover {
      background: #f8f9fa;
    }
    
    #dataTable tbody tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    #dataTable tbody tr:nth-child(even):hover {
      background: #e9ecef;
    }
    /* INFROGRÁFICOS */
    #infographicsContainer {
      position: absolute;
      top: 72px; left: 0; right: 0; bottom: 0;
      background: linear-gradient(135deg, #042945 0%, #042945 78%, #042945 0%);
      display: none;
      z-index: 1000;
      overflow-y: auto;
      padding: 32px 0;
      margin: 0;
    }
    
    /* Garantir que o menu hambúrguer esteja sempre acima do container de infográficos */
    .hamburger-menu {
      z-index: 99999 !important;
      position: relative;
    }
    
    .hamburger-dropdown {
      z-index: 99999 !important;
    }
    
    .carousel-container {
      min-height: 600px;
      transition: opacity var(--transition);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .carousel {
      position: relative;
      width: 98vw;
      max-width: 900px;
      height: 70vh;
      max-height: 600px;
      margin: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      border-radius: var(--radius);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .carousel:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.12);
    }

    .carousel-arrow {
      background: rgba(255, 255, 255, 0.95);
      border: none;
      color: var(--primary-color);
      font-size: 2.2rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      cursor: pointer;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(8px);
    }

    .carousel-arrow.left { left: 10px; }
    .carousel-arrow.right { right: 10px; }

    .carousel-arrow:hover {
      background: var(--primary-color);
      color: #fff;
      transform: translateY(-50%) scale(1.1);
      box-shadow: 0 6px 16px rgba(0,48,87,0.15);
    }

    .carousel-slides {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .carousel-slide {
      min-width: 100%;
      height: 100%;
      opacity: 0;
      position: absolute;
      top: 0; left: 0;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
      padding: 0;
    }

    .carousel-slide.active {
      opacity: 1;
      z-index: 2;
    }

    .carousel-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      background: #ffffff;
      transition: transform 0.3s ease;
    }

    .carousel-slide.active img {
      transform: scale(1);
    }

    .carousel-indicators {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      margin-top: 24px;
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      backdrop-filter: blur(8px);
    }

    .indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #e0e8f0;
      border: 2px solid var(--primary-color);
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
    }

    .indicator:hover {
      transform: scale(1.2);
      background: var(--primary-color);
    }

    .indicator.active {
      background: var(--primary-color);
      border: 2px solid var(--secondary-color);
      transform: scale(1.2);
    }

    @media (max-width: 900px) {
      .carousel { 
        max-width: 95vw; 
        height: 60vh;
        max-height: 500px;
      }
    }

    @media (max-width: 600px) {
      .carousel { 
        max-width: 92vw; 
        height: 50vh;
        max-height: 400px;
      }
      .carousel-arrow { 
        font-size: 1.5rem; 
        width: 40px; 
        height: 40px; 
      }
      .carousel-indicators { 
        gap: 10px; 
        padding: 8px;
      }
      .indicator { 
        width: 8px; 
        height: 8px; 
      }
    }

    /* Animação de transição suave */
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .carousel-slide.active {
      animation: fadeIn 0.5s ease forwards;
    }

    /* RESPONSIVIDADE */
    @media (max-width: 1100px) {
      .sidebar-left, .sidebar-right {
        width: 95vw;
        left: 2.5vw !important;
        right: 2.5vw !important;
        top: 180px;
        max-height: 40vh;
        padding: 18px 8px 12px 8px;
      }
      
       .sidebar-content {
         flex-direction: column;
         gap: 15px;
         height: auto;
         min-height: auto;
       }
      
      .entities-list {
        max-height: 250px;
      }
      
       .filters-section {
         flex: 1;
       }
      
       .entities-section {
         flex: 1;
      }
      
      /* Resetar sidebar esquerdo para mobile */
      .sidebar-left {
        position: fixed;
        top: 100px;
        left: 2.5vw;
        width: 95vw;
        height: auto;
        max-height: 40vh;
        border-radius: 0 0 16px 16px;
        border: 1.5px solid #e0e0e0;
        padding-top: 18px;
        background: linear-gradient(135deg, #ffffff 80%, #f4f6f8 100%);
      }
      
      /* Resetar mapa para mobile */
      #map {
        left: 0;
        top: 100px;
      }
      
      #infographicsContainer .carousel {
        width: 99vw;
        max-width: 99vw;
        height: 60vw;
        max-height: 320px;
      }
    }
    @media (max-width: 768px) {
      .top-header {
        height: 56px;
        padding: 4px 0;
      }
      .top-header img {
        height: 36px;
      }
      .menu-bar {
        top: 56px;
        height: 44px;
        padding: 0 4px;
      }
      #map {
        top: 100px;
        left: 0;
      }
      .sidebar-left, .sidebar-right {
        position: fixed;
        top: 100px;
        width: 100vw;
        left: 0 !important;
        right: 0 !important;
        max-height: 40vh;
        padding: 8px 2vw 8px 2vw;
        border-radius: 0 0 16px 16px;
        z-index: 2001;
        box-shadow: 0 4px 24px rgba(0,0,0,0.13);
      }
      .sidebar-left {
        position: fixed;
        transform: translateY(-100%);
        transition: transform 0.3s;
        top: 100px;
        left: 0;
        width: 100vw;
        height: auto;
        max-height: 40vh;
        border-radius: 0 0 16px 16px;
        border: 1.5px solid #e0e0e0;
        padding-top: 8px;
        background: linear-gradient(135deg, #ffffff 80%, #f4f6f8 100%);
      }
      .sidebar-right {
        transform: translateY(-100%);
        transition: transform 0.3s;
      }
      .sidebar-left.active, .sidebar-right.active {
        transform: translateY(0);
      }
      .nav-right button {
        font-size: 1rem;
        padding: 8px 8px;
      }
    #infographicsContainer {
        top: 100px;
        padding: 8px 0;
      }
      #infographicsContainer .carousel {
        width: 99vw;
        max-width: 99vw;
        height: 45vw;
        max-height: 180px;
      }
      .carousel-arrow { font-size: 1.3rem; width: 32px; height: 32px; }
      .carousel-indicators { gap: 6px; }
      .indicator { width: 8px; height: 8px; }
      .entities-list, .totals-card, #centralDetails {
        font-size: 0.98rem;
      }
    }
    @media (max-width: 480px) {
      .sidebar-left, .sidebar-right {
        top: 90px;
        max-height: 32vh;
        font-size: 0.93rem;
        padding: 6px 1vw 6px 1vw;
      }
      .sidebar-left {
        position: fixed;
        top: 90px;
        left: 0;
        width: 100vw;
        height: auto;
        max-height: 32vh;
        border-radius: 0 0 16px 16px;
        border: 1.5px solid #e0e0e0;
        padding-top: 6px;
        background: linear-gradient(135deg, #ffffff 80%, #f4f6f8 100%);
      }
      .entities-list .entity-item, .central-item, .school-item {
        font-size: 0.91rem;
      }
      #infographicsContainer .carousel {
        height: 38vw;
        max-height: 100px;
      }
      .carousel-arrow { font-size: 1rem; width: 24px; height: 24px; }
    }
    /* SCROLLBAR PERSONALIZADA */
    ::-webkit-scrollbar {
      width: 8px;
      background: #e9ecef;
      border-radius: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background: #cce0ff;
      border-radius: 8px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #b0c4de;
    }
    /* Overlay para sidebars no mobile */
    @media (max-width: 768px) {
      .sidebar-left, .sidebar-right {
        position: fixed;
        left: 0 !important;
        right: 0 !important;
        width: 100vw;
        border-radius: 0 0 16px 16px;
        z-index: 2001;
      }
    }
    /* Botão para abrir sidebars no mobile */
    .open-sidebar-btn {
      display: none;
      position: fixed;
      top: 110px;
      left: 10px;
      z-index: 2100;
      background: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.13);
      cursor: pointer;
    }
    @media (max-width: 768px) {
      .open-sidebar-btn { display: block; }
    }
    .school-card {
      background: #fff;
      border-radius: 12px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      border: 1px solid #e0e0e0;
    }

    .school-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .school-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-bottom: 1px solid #eee;
      background-color: #f5f5f5;
    }

    .school-info {
      padding: 16px;
    }

    .school-name {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 8px;
    }

    .school-details {
      font-size: 0.95rem;
      color: #666;
      line-height: 1.5;
    }

    .school-details > div {
      margin-bottom: 4px;
    }

    .school-capacity {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #eee;
      font-weight: 600;
      color: var(--secondary-color);
      font-size: 1.1rem;
    }

    #schoolsList {
      padding: 8px;
      background: #f9f9f9;
      border-radius: 8px;
      margin-top: 16px;
    }

    .school-list-item {
      padding: 12px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .school-list-item:hover {
      background-color: #f0f8ff;
    }

    .school-list-item.selected {
      background-color: #e0efff;
      border-left: 4px solid var(--primary-color);
    }

    .school-list-item .school-name {
      font-weight: 600;
      color: var(--primary-color);
    }

    .school-list-item .school-year {
      color: #666;
      font-size: 0.9em;
    }

     .school-details-header {
       display: flex;
       align-items: center;
       justify-content: space-between;
       margin-bottom: 16px;
       padding-bottom: 12px;
       border-bottom: 1px solid #e0e0e0;
     }
    
     .school-details-close {
       background: var(--primary-color);
       color: white;
       border: none;
       border-radius: 4px;
       padding: 4px 8px;
       cursor: pointer;
       font-size: 14px;
       font-weight: bold;
       display: inline-flex;
       align-items: center;
       justify-content: center;
       margin-left: 8px;
       transition: background-color 0.3s ease;
     }
    
    .school-details-close:hover {
      background: #003d82;
    }

    /* Ícones personalizados para os pins */
    .custom-marker {
      background: transparent !important;
      border: none !important;
    }

    .marker-pin {
      width: 25px;
      height: 25px;
      border-radius: 50% 50% 50% 0;
      transform: rotate(-45deg);
      border: 2px solid white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      position: relative;
    }

    .marker-pin::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(45deg);
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: white;
    }

    /* Pin das centrais (azul) */
    .central-pin {
      background: var(--primary-color);
    }

    /* Pin das escolas (dourado) */
    .school-pin {
      background: var(--primary-color);
    }
    

    .school-details-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background-color: #f5f5f5;
    }

    .school-details-content {
      padding: 16px;
    }

    .school-details-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 12px;
    }

    .school-details-info {
      margin-bottom: 8px;
      color: #666;
    }

    .school-details-info i {
      width: 20px;
      color: var(--primary-color);
      margin-right: 8px;
    }

    .school-details-capacity {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #eee;
      font-weight: 600;
      color: var(--secondary-color);
    }

    /* =========================================================================
       ESTILOS DOS FILTROS
    ========================================================================= */
    .filters-section {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      padding: 18px;
      margin-bottom: 20px;
      border: 1px solid #dee2e6;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .filters-section h3 {
      font-size: 1.1rem;
      color: var(--dark-blue);
      margin-bottom: 16px;
      font-weight: normal;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filters-section h3::before {
      content: '\f0b0';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      color: var(--primary-color);
    }

    .filter-group {
      margin-bottom: 14px;
    }

    .filter-group label {
      display: block;
      font-size: 0.95rem;
      color: var(--dark-blue);
      margin-bottom: 6px;
      font-weight: normal;
    }

    .filter-select {
      width: 100%;
      padding: 10px 12px;
      border: 1.5px solid #d1d5db;
      border-radius: 8px;
      background: var(--white);
      font-size: 0.95rem;
      color: var(--dark-blue);
      transition: border-color var(--transition), box-shadow var(--transition);
      cursor: pointer;
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0,48,87,0.1);
    }

    .filter-select:hover {
      border-color: var(--secondary-color);
    }

     .custom-dropdown {
       position: relative;
      width: 100%;
     }
    
     .dropdown-selected {
      width: 100%;
       padding: 10px 12px;
       border: 1.5px solid #d1d5db;
      border-radius: 8px;
       background: var(--white);
      font-size: 0.95rem;
       color: var(--dark-blue);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
       transition: border-color var(--transition), box-shadow var(--transition);
     }
    
     .dropdown-selected:hover {
       border-color: var(--secondary-color);
     }
    
     .dropdown-selected.active {
       border-color: var(--primary-color);
       box-shadow: 0 0 0 3px rgba(0,48,87,0.1);
     }
    
     .dropdown-arrow {
       transition: transform var(--transition);
       font-size: 0.8rem;
       color: #6b7280;
     }
    
     .dropdown-selected.active .dropdown-arrow {
       transform: rotate(180deg);
     }
    
     .dropdown-menu {
       position: absolute;
       top: 100%;
       left: 0;
       right: 0;
       background: var(--white);
       border: 1.5px solid #d1d5db;
       border-top: none;
       border-radius: 0 0 8px 8px;
       box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      z-index: 1000;
       max-height: 200px;
       overflow: hidden;
      display: none;
     }
    
     .dropdown-menu.show {
       display: block;
     }
    
     .dropdown-search {
       padding: 8px;
       border-bottom: 1px solid #e5e7eb;
     }
    
     .dropdown-search input {
      width: 100%;
       padding: 8px 12px;
       border: 1px solid #d1d5db;
       border-radius: 4px;
       font-size: 0.9rem;
       outline: none;
     }
    
     .dropdown-search input:focus {
       border-color: var(--primary-color);
       box-shadow: 0 0 0 2px rgba(0,48,87,0.1);
     }
    
     .dropdown-options {
       max-height: 150px;
       overflow-y: auto;
     }
    
     .dropdown-option {
       padding: 10px 12px;
       cursor: pointer;
       font-size: 0.95rem;
       color: var(--dark-blue);
       transition: background-color var(--transition);
     }
    
     .dropdown-option:hover {
       background-color: #f3f4f6;
     }
    
     .dropdown-option.selected {
       background-color: var(--primary-color);
       color: white;
     }

    .filter-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: auto;
      padding-top: 8px;
    }
    
     .sidebar-content {
       display: flex;
       gap: 20px;
       margin-top: 20px;
       flex: 1;
       min-height: 0;
       overflow: visible;
       align-items: stretch;
       padding-bottom: 20px;
     }
    
     .filters-section {
       flex: 1;
       min-width: 0;
      display: flex;
      flex-direction: column;
       justify-content: space-between;
     }
    
     .entities-section {
       flex: 1.2;
       min-width: 0;
      display: flex;
      flex-direction: column;
       height: calc(100vh - 200px);
     }
    
     .entities-list {
       flex: 1;
       overflow-y: auto;
       min-height: 0;
       margin-bottom: 0;
       margin-top: 0;
       padding-top: 0;
       height: calc(100vh - 240px);
     }
    
     .entities-section h3 {
       font-size: 0.95rem;
       color: var(--dark-blue);
       margin-bottom: 4px;
       padding-bottom: 2px;
       border-bottom: 1px solid #e0e0e0;
       font-weight: 600;
     }
    
     /* Spinner de carregamento */
     .loading-spinner {
      display: flex;
      justify-content: center;
      align-items: center;
       padding: 40px 20px;
     }
    
     .spinner {
       width: 40px;
       height: 40px;
       border: 4px solid #e3f2fd;
       border-top: 4px solid var(--primary-color);
       border-radius: 50%;
       animation: spin 1s linear infinite;
     }
    
     @keyframes spin {
       0% { transform: rotate(0deg); }
       100% { transform: rotate(360deg); }
     }
    
     .loading-text {
       margin-left: 12px;
       color: var(--primary-color);
       font-size: 0.9rem;
       font-weight: 500;
     }

     .filter-btn {
       width: 100%;
       padding: 12px 16px;
       border: 1.5px solid #B29637;
       border-radius: 25px;
       font-size: 0.95rem;
       font-weight: normal;
      cursor: pointer;
       transition: all var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
       gap: 8px;
       background: #f8f6f2;
       color: #B29637;
       box-shadow: 0 2px 8px rgba(178, 150, 55, 0.1);
     }

     .filter-btn:hover {
       background: #B29637;
       color: #f8f6f2;
       box-shadow: 0 4px 12px rgba(178, 150, 55, 0.2);
       transform: translateY(-1px);
     }

     .filter-btn.secondary {
       background: transparent;
       border: 1px solid #d1d5db;
       color: #6c757d;
       box-shadow: none;
       font-size: 0.9rem;
       padding: 10px 16px;
     }

     .filter-btn.secondary:hover {
       background: #f8f9fa;
       border-color: #adb5bd;
       color: #495057;
    }
  </style>
</head>
<body>
  <div id="instructionModal">
    <div class="instruction-content">
      <h2>Bem-vindo ao Mapa Interativo com alguns dados das Centrais do Dízimo no Brasil e no mundo!</h2>
      <ul>
        <li>Clique no botão "Entidades Atendidas" para ver a quantidade de doações realizadas por cada Central do Dízimo, as entidades atendidas e o ano em que foram beneficiadas.</li>
        <li>Clique no botão "Escolas Profissionalizantes" para ver as escolas doadas, sua localização, informações sobre o edifício e cursos oferecidos, além de suas capacidades de formação de alunos por ano.</li>
        <li>Use o botão "Ver Gráficos" para visualizar a evolução histórica das doações.</li>
        <li>Use o botão "Infográficos" para ver algumas informações pontuais sobre as doações realizadas.</li>
        <li>Clique em qualquer espaço do mapa para voltar ao resumo global.</li>
      </ul>
      <button id="closeInstructionBtn">Vamos Lá!</button>
    </div>
  </div>

  <!-- Modal de Instruções -->
  <div id="instructionsModal" class="instructions-modal">
    <div class="instructions-content">
      <div class="instructions-header">
        <h2>Como Navegar no Sistema</h2>
        <button id="closeInstructionsBtn" class="close-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="instructions-body">
        <div class="instruction-section">
          <h3><i class="fas fa-chart-line"></i> Entidades Atendidas</h3>
          <p>Visualize doações por central, cidade, país e ano. Use os filtros para explorar os dados e clique nos pins do mapa para filtrar automaticamente.</p>
        </div>
        <div class="instruction-section">
          <h3><i class="fas fa-school"></i> Escolas Profissionalizantes</h3>
          <p>Explore as escolas cadastradas, visualize detalhes ao clicar nos pins ou na lista, e veja informações completas no painel lateral.</p>
        </div>
        <div class="instruction-section">
          <h3><i class="fas fa-chart-bar"></i> Gráfico de Evolução</h3>
          <p>Analise o crescimento das doações ao longo dos anos com marcos históricos das primeiras doações em cada país.</p>
        </div>
        <div class="instruction-section">
          <h3><i class="fas fa-images"></i> Infográficos</h3>
          <p>Navegue pelas imagens informativas usando as setas ou indicadores para conhecer mais sobre o trabalho da Central do Dízimo.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Carregamento -->
  <div id="loadingModal" class="loading-modal">
    <div class="loading-content">
      <div class="loading-spinner">
        <div class="spinner"></div>
      </div>
      <h3>Carregando Sistema</h3>
      <p>Preparando todas as informações...</p>
    </div>
  </div>

  <div class="unified-header">
    <div class="header-top">
      <div class="header-left">
        <button id="howToNavigateBtn" class="help-btn">
          <i class="fas fa-question-circle"></i> Como Navegar
        </button>
      </div>
      <div class="header-center">
      <div class="logo-section">
        <img src="logo.png" alt="Logo PRÓ-VIDA">
      </div>
    </div>
      <div class="header-right">
        <div class="hamburger-menu">
          <button id="hamburgerBtn" class="hamburger-btn">
            <span class="menu-text">Menu</span>
            <div class="hamburger-lines">
            <span></span>
            <span></span>
            <span></span>
            </div>
          </button>
          <div id="hamburgerDropdown" class="hamburger-dropdown">
          <button id="donationsBtn" class="active">Entidades Atendidas</button>
          <button id="schoolsBtn">Escolas Profissionalizantes</button>
          <button id="infographicsBtn">Infográficos</button>
          <button id="chartBtn">Ver Gráfico</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="map"></div>

  <div class="sidebar-left" id="sidebarLeft">
    <div id="donationsSidebar">
      <div class="sidebar-header">
      <h2>Resumo de Doações</h2>
        <button id="viewDataTableBtn" class="view-table-btn" title="Ver dados em tabela">
          <i class="fas fa-search"></i>
        </button>
      </div>
      
      <div class="totals-card">
        <div>
          <i class="fas fa-hand-holding-heart"></i>
          <strong id="totalDoacoes">0</strong><br>Doações
        </div>
      </div>
     
      <div class="sidebar-content">
      <div class="filters-section">
        <h3>Filtros</h3>
        <div class="filter-group">
          <label for="filterCentral">Central:</label>
            <div class="custom-dropdown" id="dropdownCentral">
              <div class="dropdown-selected" id="selectedCentral">
                <span class="selected-text">Todos</span>
                <span class="dropdown-arrow">▼</span>
              </div>
              <div class="dropdown-menu" id="menuCentral">
                <div class="dropdown-search">
                  <input type="text" id="searchCentral" placeholder="Pesquisar central..." autocomplete="off">
                </div>
                <div class="dropdown-options" id="optionsCentral"></div>
              </div>
            </div>
        </div>
        <div class="filter-group">
          <label for="filterCidade">Cidade da Entidade:</label>
            <div class="custom-dropdown" id="dropdownCidade">
              <div class="dropdown-selected" id="selectedCidade">
                <span class="selected-text">Todos</span>
                <span class="dropdown-arrow">▼</span>
              </div>
              <div class="dropdown-menu" id="menuCidade">
                <div class="dropdown-search">
                  <input type="text" id="searchCidade" placeholder="Pesquisar cidade..." autocomplete="off">
                </div>
                <div class="dropdown-options" id="optionsCidade"></div>
              </div>
            </div>
        </div>
        <div class="filter-group">
          <label for="filterPais">País da Entidade:</label>
            <div class="custom-dropdown" id="dropdownPais">
              <div class="dropdown-selected" id="selectedPais">
                <span class="selected-text">Todos</span>
                <span class="dropdown-arrow">▼</span>
              </div>
              <div class="dropdown-menu" id="menuPais">
                <div class="dropdown-search">
                  <input type="text" id="searchPais" placeholder="Pesquisar país..." autocomplete="off">
                </div>
                <div class="dropdown-options" id="optionsPais"></div>
              </div>
            </div>
        </div>
        <div class="filter-group">
          <label for="filterAno">Ano da Doação:</label>
            <div class="custom-dropdown" id="dropdownAno">
              <div class="dropdown-selected" id="selectedAno">
                <span class="selected-text">Todos</span>
                <span class="dropdown-arrow">▼</span>
              </div>
              <div class="dropdown-menu" id="menuAno">
                <div class="dropdown-search">
                  <input type="text" id="searchAno" placeholder="Pesquisar ano..." autocomplete="off">
                </div>
                <div class="dropdown-options" id="optionsAno"></div>
              </div>
            </div>
        </div>
        <div class="filter-actions">
          <button id="clearFiltersBtn" class="filter-btn secondary">
              <i class="fas fa-times"></i> Limpar Filtros
          </button>
        </div>
      </div>
      
        <div class="entities-section">
          <h3>Lista de Doações</h3>
      <div class="entities-list" id="entitiesList">
        <div class="entity-item">
          Selecione uma central para ver os detalhes ou visualize os totais agregados.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="schoolsSidebar" style="display: none;">
      <h2>Escolas Profissionalizantes</h2>
      <div class="totals-card">
        <div>
          <i class="fas fa-school"></i>
          <strong id="totalEscolas">0</strong><br>Escolas
        </div>
      </div>
      <div class="entities-list" id="schoolsList">
      </div>
    </div>
  </div>

  <div class="sidebar-right" id="sidebarRight" style="display: none;">
    <div id="donationsDetails" style="display: none;">
      <h2>Centrais e Países</h2>
      <div id="centralDetails">Nenhuma central selecionada</div>
      <div id="centraisList"></div>
    </div>

    <div id="schoolDetails" style="display: none;">
      <div id="selectedSchoolInfo">
        Selecione uma escola para ver os detalhes.
      </div>
    </div>
  </div>

  <div id="chartContainer" style="display: none;">
    <div class="chart-wrapper">
      <h2 class="chart-title">Evolução das Doações - Central do Dízimo</h2>
      <canvas id="donationsChart"></canvas>
    </div>
  </div>

  <div id="fullscreenListSection" style="display: none;">
    <div class="fullscreen-list-wrapper">
      <div class="fullscreen-list-header">
        <h2>Lista Completa de Doações</h2>
        <button class="close-fullscreen-btn" id="closeFullscreenListBtn">×</button>
      </div>
      <div class="fullscreen-list-content">
        <div class="fullscreen-list-container" id="fullscreenListContainer">
          </div>
      </div>
    </div>
  </div>

  <div id="infographicsContainer" style="display: none;">
    <div class="carousel">
      <button class="carousel-arrow left" id="carouselPrev" aria-label="Anterior"><i class="fas fa-chevron-left"></i></button>
      <div class="carousel-slides">
        <div class="carousel-slide active"><img src="info1.png" alt="Infográfico 1"></div>
        <div class="carousel-slide"><img src="info2.png" alt="Infográfico 2"></div>
        <div class="carousel-slide"><img src="info3.png" alt="Infográfico 3"></div>
        <div class="carousel-slide"><img src="info4.png" alt="Infográfico 4"></div>
        </div>
      <button class="carousel-arrow right" id="carouselNext" aria-label="Próximo"><i class="fas fa-chevron-right"></i></button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    /* =========================================================================
        CONFIGURAÇÃO E INICIALIZAÇÃO GERAL
    ========================================================================= */
    const supabaseUrl = 'https://wmxwkvmnpfcrylxvkbdi.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndteHdrdm1ucGZjcnlseHZrYmRpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0Mzc0MDA5NSwiZXhwIjoyMDU5MzE2MDk1fQ.JEt1mEewe3p8U8gxmGchlgrbHpaptuYKRs44vWppCPk';
    const _supabase = supabase.createClient(supabaseUrl, supabaseKey);
    
     const map = L.map('map').setView([20, -20], 3);
     L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);
     let markersLayer = L.layerGroup().addTo(map);
     let countryLayer; // Variável para a camada de destaque do país
     let allDonationsData = []; // Cache global para os dados de doação

     /* =========================================================================
        LÓGICA DE FILTRAGEM E BUSCA DE DADOS
     ========================================================================= */

    async function fetchAllRows(queryBuilder) {
        const BATCH_SIZE = 1000;
        let allData = [];
        let page = 0;
        let lastBatchLength = 0;
        console.log("🔄 Buscando todos os registros com paginação...");
        while (true) {
            const { data, error } = await queryBuilder.range(page * BATCH_SIZE, (page + 1) * BATCH_SIZE - 1);
      if (error) {
                console.error("❌ Erro durante a paginação da busca:", error);
                return allData;
            }
            if (data && data.length > 0) {
                allData = allData.concat(data);
                lastBatchLength = data.length;
          } else {
                break;
            }
            if (lastBatchLength < BATCH_SIZE) {
                break;
            }
            page++;
        }
        console.log(`✅ Busca completa. Total de ${allData.length} registros obtidos.`);
        return allData;
    }

    function applyFiltersToQuery(query, filters) {
        if (filters.central) query = query.eq('central', filters.central);
        if (filters.cidade) query = query.eq('cidade_entidade', filters.cidade);
        if (filters.pais) query = query.eq('pais_entidade', filters.pais);
        if (filters.ano) query = query.eq('ano', filters.ano);
        return query;
    }

    async function applyAndRefreshFilters() {
        console.log("🚀 INICIANDO APLICAÇÃO E ATUALIZAÇÃO DE FILTROS...");
        document.getElementById('entitiesList').innerHTML = `<div class="loading-spinner"><div class="spinner"></div><div class="loading-text">Carregando dados...</div></div>`;
        const currentValues = {
            central: document.getElementById('dropdownCentral').dataset.selectedValue || '',
            cidade: document.getElementById('dropdownCidade').dataset.selectedValue || '',
            pais: document.getElementById('dropdownPais').dataset.selectedValue || '',
            ano: document.getElementById('dropdownAno').dataset.selectedValue || '',
        };
        console.log("Valores Atuais:", currentValues);
        await Promise.all([
            updateFilterOptions('central', 'filterCentral', currentValues),
            updateFilterOptions('cidade_entidade', 'filterCidade', currentValues),
            updateFilterOptions('pais_entidade', 'filterPais', currentValues),
            updateFilterOptions('ano', 'filterAno', currentValues),
        ]);
        let resultsQuery = _supabase.from('zi_vw_dados_infografico_v2').select('nome_entidade, tipo_atend_entidade, central, cidade_entidade, ano, num_prog');
        resultsQuery = applyFiltersToQuery(resultsQuery, currentValues);
        const data = await fetchAllRows(resultsQuery);
        updateEntitiesList(data);
        const totalRegistros = data.length;
        document.getElementById('totalDoacoes').innerText = totalRegistros.toLocaleString('pt-BR');
        console.log(`✅ Filtragem concluída: ${totalRegistros} registros.`);
        await loadCentralsPins();
    }

    async function updateFilterOptions(dbField, selectId, allCurrentFilters) {
        const filtersForThisQuery = { ...allCurrentFilters };
        const filterKey = selectId.replace('filter', '').toLowerCase();
        delete filtersForThisQuery[filterKey];
        let optionsQuery = _supabase.from('zi_vw_dados_infografico_v2').select(dbField).not(dbField, 'is', null);
        optionsQuery = applyFiltersToQuery(optionsQuery, filtersForThisQuery);
        const data = await fetchAllRows(optionsQuery);
        let options = [...new Set(data.map(item => item[dbField]))];
        if (dbField === 'ano') {
            options.sort((a, b) => b - a);
      } else {
            options.sort((a, b) => String(a).localeCompare(String(b)));
        }
        populateFilterSelect(selectId, options, allCurrentFilters[filterKey]);
    }

    function populateFilterSelect(selectId, options, selectedValue) {
        const dropdownId = selectId.replace('filter', 'dropdown');
        const selectedId = selectId.replace('filter', 'selected');
        const optionsId = selectId.replace('filter', 'options');
        const dropdown = document.getElementById(dropdownId);
        const optionsContainer = document.getElementById(optionsId);
        dropdown.dataset.allOptions = JSON.stringify(options);
        optionsContainer.innerHTML = '';
        const allOption = document.createElement('div');
        allOption.className = 'dropdown-option';
        allOption.dataset.value = '';
        allOption.textContent = 'Todos';
        allOption.addEventListener('click', () => selectOption(selectId, '', 'Todos'));
        optionsContainer.appendChild(allOption);
        options.forEach(option => {
            if (option) {
                const optionElement = document.createElement('div');
                optionElement.className = 'dropdown-option';
                optionElement.dataset.value = option;
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => selectOption(selectId, option, option));
                optionsContainer.appendChild(optionElement);
            }
        });
        const selected = document.getElementById(selectedId);
        if (selectedValue) {
            selected.querySelector('.selected-text').textContent = selectedValue;
            dropdown.dataset.selectedValue = selectedValue;
        } else {
            selected.querySelector('.selected-text').textContent = 'Todos';
            dropdown.dataset.selectedValue = '';
        }
    }

    function selectOption(selectId, value, text) {
        const dropdownId = selectId.replace('filter', 'dropdown');
        const selectedId = selectId.replace('filter', 'selected');
        const menuId = selectId.replace('filter', 'menu');
        const dropdown = document.getElementById(dropdownId);
        const selected = document.getElementById(selectedId);
        const menu = document.getElementById(menuId);
        selected.querySelector('.selected-text').textContent = text;
        dropdown.dataset.selectedValue = value;
        selected.classList.remove('active');
        menu.classList.remove('show');
        const searchId = selectId.replace('filter', 'search');
        const searchInput = document.getElementById(searchId);
        if (searchInput) {
            searchInput.value = '';
        }
        const changeEvent = new Event('change', { bubbles: true });
        dropdown.dispatchEvent(changeEvent);
    }

    function filterDropdownOptions(searchId, selectId) {
        const searchInput = document.getElementById(searchId);
        const optionsId = selectId.replace('filter', 'options');
        const dropdownId = selectId.replace('filter', 'dropdown');
        const searchTerm = searchInput.value.toLowerCase();
        const optionsContainer = document.getElementById(optionsId);
        const dropdown = document.getElementById(dropdownId);
        const allOptions = JSON.parse(dropdown.dataset.allOptions || '[]');
        optionsContainer.innerHTML = '';
        const allOption = document.createElement('div');
        allOption.className = 'dropdown-option';
        allOption.dataset.value = '';
        allOption.textContent = 'Todos';
        allOption.addEventListener('click', () => selectOption(selectId, '', 'Todos'));
        optionsContainer.appendChild(allOption);
        allOptions.forEach(option => {
            if (option && option.toString().toLowerCase().includes(searchTerm)) {
                const optionElement = document.createElement('div');
                optionElement.className = 'dropdown-option';
                optionElement.dataset.value = option;
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => selectOption(selectId, option, option));
                optionsContainer.appendChild(optionElement);
        }
      });
    }

    function initializeSearchFilters() {
        const dropdownMappings = [
            { dropdownId: 'dropdownCentral', selectId: 'filterCentral' },
            { dropdownId: 'dropdownCidade', selectId: 'filterCidade' },
            { dropdownId: 'dropdownPais', selectId: 'filterPais' },
            { dropdownId: 'dropdownAno', selectId: 'filterAno' }
        ];
        dropdownMappings.forEach(mapping => {
            const dropdown = document.getElementById(mapping.dropdownId);
            const selected = document.getElementById(mapping.dropdownId.replace('dropdown', 'selected'));
            const menu = document.getElementById(mapping.dropdownId.replace('dropdown', 'menu'));
            const searchId = mapping.selectId.replace('filter', 'search');
            const searchInput = document.getElementById(searchId);
            if (dropdown && selected && menu && searchInput) {
                selected.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isActive = selected.classList.contains('active');
                    document.querySelectorAll('.dropdown-selected').forEach(el => el.classList.remove('active'));
                    document.querySelectorAll('.dropdown-menu').forEach(el => el.classList.remove('show'));
                    if (!isActive) {
                        selected.classList.add('active');
                        menu.classList.add('show');
                        searchInput.focus();
                    }
                });
                searchInput.addEventListener('input', () => filterDropdownOptions(searchId, mapping.selectId));
                document.addEventListener('click', (e) => {
                    if (!dropdown.contains(e.target)) {
                        selected.classList.remove('active');
                        menu.classList.remove('show');
                    }
                });
            }
        });
    }

    async function openFullscreenList() {
        console.log('🔍 Abrindo lista em tela cheia...');
        try {
            const currentValues = {
                central: document.getElementById('dropdownCentral').dataset.selectedValue || '',
                cidade: document.getElementById('dropdownCidade').dataset.selectedValue || '',
                pais: document.getElementById('dropdownPais').dataset.selectedValue || '',
                ano: document.getElementById('dropdownAno').dataset.selectedValue || '',
            };
            let resultsQuery = _supabase.from('zi_vw_dados_infografico_v2').select('nome_entidade, tipo_atend_entidade, central, cidade_entidade, ano, num_prog');
            resultsQuery = applyFiltersToQuery(resultsQuery, currentValues);
            const data = await fetchAllRows(resultsQuery);
            const container = document.getElementById('fullscreenListContainer');
            if (!container) return;
      container.innerHTML = '';
            if (data.length === 0) {
                container.innerHTML = '<div class="entity-item">Nenhuma doação encontrada com os filtros aplicados.</div>';
            } else {
                data.forEach(item => {
                    const entityDiv = document.createElement('div');
                    entityDiv.className = 'entity-item';
                    entityDiv.innerHTML = `<div style="font-weight: 600; margin-bottom: 4px;">${item.nome_entidade}</div><div style="font-size: 0.9rem; color: #666;"><i class="fas fa-building"></i> ${item.central} | <i class="fas fa-map-marker-alt"></i> ${item.cidade_entidade} | <i class="fas fa-calendar"></i> ${item.ano}</div>`;
                    container.appendChild(entityDiv);
                });
            }
            const section = document.getElementById('fullscreenListSection');
            if (section) section.style.display = 'flex';
        } catch (error) {
            console.error('Erro ao abrir lista em tela cheia:', error);
        }
    }

    function closeFullscreenList() {
        const section = document.getElementById('fullscreenListSection');
        if (section) section.style.display = 'none';
    }

    function updateEntitiesList(data) {
      const listEl = document.getElementById('entitiesList');
        listEl.innerHTML = '';
        if (!data || data.length === 0) {
            listEl.innerHTML = '<div class="entity-item">Nenhuma entidade encontrada.</div>';
            return;
        }
      data.forEach(ent => {
        const div = document.createElement('div');
        div.className = 'entity-item';
            div.innerHTML = `<div style="font-weight: 600;">${ent.nome_entidade}</div><div style="font-size:0.9em; color:#555; margin-top:4px;"><i class="fas fa-building"></i> ${ent.central || 'N/A'} | <i class="fas fa-map-marker-alt"></i> ${ent.cidade_entidade || 'N/A'} | <i class="far fa-calendar-alt"></i> ${ent.ano || 'N/A'}</div>`;
        listEl.appendChild(div);
      });
    }

    async function clearFilters() {
        console.log("🧹 Limpando todos os filtros...");
        const dropdowns = ['dropdownCentral', 'dropdownCidade', 'dropdownPais', 'dropdownAno'];
        dropdowns.forEach(dropdownId => {
            const dropdown = document.getElementById(dropdownId);
            const selected = document.getElementById(dropdownId.replace('dropdown', 'selected'));
            const searchInput = document.getElementById(dropdownId.replace('dropdown', 'search'));
            if (dropdown && selected && searchInput) {
                dropdown.dataset.selectedValue = '';
                selected.querySelector('.selected-text').textContent = 'Todos';
                searchInput.value = '';
            }
        });
        await applyAndRefreshFilters();
    }

    function parseCoord(coord) {
        if (!coord) return null;
        const parsed = parseFloat(coord);
        return isNaN(parsed) ? null : parsed;
    }

    async function filterByCentral(centralName) {
        console.log(`🔍 Filtrando por central: ${centralName}`);
        try {
            const dropdownCentral = document.getElementById('dropdownCentral');
            const selectedCentral = document.getElementById('selectedCentral');
            if (dropdownCentral && selectedCentral) {
                dropdownCentral.dataset.selectedValue = centralName;
                selectedCentral.querySelector('.selected-text').textContent = centralName;
                const otherDropdowns = ['dropdownCidade', 'dropdownPais', 'dropdownAno'];
                otherDropdowns.forEach(dropdownId => {
                    const dropdown = document.getElementById(dropdownId);
                    const selected = document.getElementById(dropdownId.replace('dropdown', 'selected'));
                    const searchInput = document.getElementById(dropdownId.replace('dropdown', 'search'));
                    if (dropdown && selected && searchInput) {
                        dropdown.dataset.selectedValue = '';
                        selected.querySelector('.selected-text').textContent = 'Todos';
                        searchInput.value = '';
                    }
                });
                await applyAndRefreshFilters();
                console.log(`✅ Filtro aplicado para central: ${centralName}`);
            }
      } catch (error) {
            console.error('❌ Erro ao filtrar por central:', error);
        }
    }

    async function loadCentralsPins() {
        console.log('📍 Carregando pins das centrais no modo donations...');
        try {
            const { data: centraisData, error } = await _supabase.from('cadastro_centrais_2').select('nome_central, latitude_dec, longitude_dec').not('latitude_dec', 'is', null).not('longitude_dec', 'is', null);
      if (error) {
                console.error('❌ Erro ao carregar centrais:', error);
          return;
        }
            if (!centraisData || centraisData.length === 0) {
                console.log('⚠️ Nenhuma central com coordenadas encontrada');
            return;
          }
            const processedData = centraisData.map(item => ({...item, lat: parseCoord(item.latitude_dec), lng: parseCoord(item.longitude_dec)})).filter(item => item.lat !== null && item.lng !== null);
            const uniqueCentrals = processedData.reduce((acc, current) => {
                if (!acc.find(item => item.nome_central === current.nome_central)) {
                    acc.push(current);
                }
                return acc;
            }, []);
            console.log(`✅ ${uniqueCentrals.length} centrais únicas encontradas`);
            markersLayer.clearLayers();
            // Criar ícone personalizado para centrais (azul)
            const centralIcon = L.divIcon({
                className: 'custom-marker central-marker',
                html: '<div class="marker-pin central-pin"></div>',
                iconSize: [25, 25],
                iconAnchor: [12, 12]
            });

            uniqueCentrals.forEach(central => {
                if (central.lat && central.lng) {
                    const marker = L.marker([central.lat, central.lng], { icon: centralIcon }).addTo(markersLayer).bindPopup(`<div style="text-align: center; padding: 10px;"><h3 style="margin: 0 0 8px 0; color: var(--primary-color);">${central.nome_central}</h3><p style="margin: 0; font-size: 0.9em; color: #666;"><i class="fas fa-map-marker-alt"></i> Central CGD</p></div>`);
                    marker.on('click', () => filterByCentral(central.nome_central));
                }
            });
        console.log('✅ Pins das centrais carregados com sucesso!');
      } catch (error) {
        console.error('❌ Erro ao carregar pins das centrais:', error);
      }
    }

    // Variável global para armazenar o layer dos países
    let countriesLayer = null;

    /**
     * Carrega e destaca os países no modo donations usando GeoJSON real
     * Os países sempre permanecem visíveis, independente dos filtros
     */
    async function loadCountriesHighlight() {
        console.log('🌍 Carregando destaque dos países...');
        
        try {
            // Buscar países da tabela zc_vw_paises_entidades
            const { data: countriesData, error } = await _supabase
                .from('zc_vw_paises_entidades')
                .select('pais_entidade');
        
      if (error) {
                console.error('❌ Erro ao carregar países:', error);
          return;
        }

            if (!countriesData || countriesData.length === 0) {
                console.log('⚠️ Nenhum país encontrado');
            return;
          }
          
            console.log(`✅ ${countriesData.length} países encontrados`);
            
            // Carregar GeoJSON dos países do mundo
            const response = await fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json');
            const worldData = await response.json();
            
            // Normalizar nomes dos países
            const normalizeCountryName = (name) => {
                // Mapeamento de países para nomes padronizados
                const countryMapping = {
                    'brasil': 'brazil',
                    'estados unidos': 'united states of america',
                    'estados unidos da américa': 'united states',
                    'usa': 'united states',
                    'itália': 'italy',
                    'italia': 'italy',
                    'bolívia': 'bolivia',
                    'bolivia': 'bolivia',
                    'polônia': 'poland',
                    'polonia': 'poland',
                    'romênia': 'romania',
                    'romania': 'romania',
                    'uruguai': 'uruguay'
                };
                
                const normalized = name.toLowerCase()
                    .replace(/[àáâãäå]/g, 'a')
                    .replace(/[èéêë]/g, 'e')
                    .replace(/[ìíîï]/g, 'i')
                    .replace(/[òóôõö]/g, 'o')
                    .replace(/[ùúûü]/g, 'u')
                    .replace(/[ç]/g, 'c')
                    .replace(/[ñ]/g, 'n')
                    .trim();
                
                return countryMapping[normalized] || normalized;
            };
            
            // Criar conjunto de países da base de dados (normalizados)
            const paisesEntidades = new Set(countriesData.map(c => normalizeCountryName(c.pais_entidade)));
            
            // Criar mapeamento reverso: nome normalizado -> nome original da base
            const countryNameMapping = {};
            countriesData.forEach(country => {
                const normalizedName = normalizeCountryName(country.pais_entidade);
                countryNameMapping[normalizedName] = country.pais_entidade;
            });
            
            // Verificar se já existe layer (evitar duplicação)
            if (countriesLayer) {
                console.log('🌍 Layer dos países já existe, mantendo...');
          return;
        }
        
            // Criar layer GeoJSON com destaque dourado (sempre visível)
            countriesLayer = L.geoJSON(worldData, {
                style: (feature) => {
                    const countryName = normalizeCountryName(feature.properties.name);
                    
                    if (paisesEntidades.has(countryName)) {
                      return {
                            fillColor: '#D4AF37',    // Dourado mais opaco no interior
                            fillOpacity: 0.4,
                            color: '#B29637',        // Dourado forte nas bordas
                            weight: 2,
                            opacity: 0.9
                        };
                    }
                    
                    return {
                        fillOpacity: 0,
                        weight: 0,
                        color: 'transparent'
                    };
                }
            }).addTo(map); // Adicionar diretamente ao mapa, não ao markersLayer
            
            // Adicionar popups e eventos de clique para países destacados
            countriesLayer.eachLayer((layer) => {
                if (layer.feature && layer.feature.properties) {
                    const countryName = layer.feature.properties.name;
                    const normalizedName = normalizeCountryName(countryName);
                    
                    if (paisesEntidades.has(normalizedName)) {
                        // Obter nome original da base de dados
                        const originalCountryName = countryNameMapping[normalizedName];
                        
                        // Adicionar popup
                        layer.bindPopup(`
                            <div style="text-align: center; padding: 10px;">
                                <h3 style="margin: 0 0 8px 0; color: #B29637;">${countryName}</h3>
                                <p style="margin: 0; font-size: 0.9em; color: #666;"> </p>
                                <p style="margin: 8px 0 0 0; font-size: 0.8em; color: #999;">
                                    Clique para filtrar por este país
                                </p>
        </div>
                        `);
                        
                        // Adicionar evento de clique para filtrar por país (usando nome original da base)
                        layer.on('click', function() {
                            console.log(`País selecionado: ${countryName} -> Filtrando por: ${originalCountryName}`);
                            filterByCountry(originalCountryName);
                        });
                    }
                }
            });
            
            console.log('✅ Países destacados com sucesso usando GeoJSON!');
            
        } catch (error) {
            console.error('❌ Erro ao carregar destaque dos países:', error);
        }
    }

    /**
     * Filtra por país selecionado
     */
    async function filterByCountry(countryName) {
        console.log(`🔍 Filtrando por país: ${countryName}`);
        try {
            const dropdownPais = document.getElementById('dropdownPais');
            const selectedPais = document.getElementById('selectedPais');
            if (dropdownPais && selectedPais) {
                dropdownPais.dataset.selectedValue = countryName;
                selectedPais.querySelector('.selected-text').textContent = countryName;
                
                // Limpar outros filtros
                const otherDropdowns = ['dropdownCentral', 'dropdownCidade', 'dropdownAno'];
                otherDropdowns.forEach(dropdownId => {
                    const dropdown = document.getElementById(dropdownId);
                    const selected = document.getElementById(dropdownId.replace('dropdown', 'selected'));
                    const searchId = dropdownId.replace('dropdown', 'search');
                    const searchInput = document.getElementById(searchId);
                    if (dropdown && selected && searchInput) {
                        dropdown.dataset.selectedValue = '';
                        selected.querySelector('.selected-text').textContent = 'Todos';
                        searchInput.value = '';
                    }
                });
                
                await applyAndRefreshFilters();
                console.log(`✅ Filtro aplicado para país: ${countryName}`);
        }
      } catch (error) {
            console.error('❌ Erro ao filtrar por país:', error);
        }
    }

    /**
     * Inicializa o carousel de infográficos
     */
    function initializeCarousel() {
        console.log('🎠 Inicializando carousel de infográficos...');
        
        const slides = document.querySelectorAll('.carousel-slide');
        const prevBtn = document.getElementById('carouselPrev');
        const nextBtn = document.getElementById('carouselNext');
        
        if (!slides.length || !prevBtn || !nextBtn) {
            console.log('⚠️ Elementos do carousel não encontrados');
        return;
      }

        let currentSlide = 0;
        const totalSlides = slides.length;
        
        // Função para mostrar slide específico
        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
            currentSlide = index;
            console.log(`📸 Slide ${index + 1} de ${totalSlides} exibido`);
        }
        
        // Função para próximo slide
        function nextSlide() {
            const nextIndex = (currentSlide + 1) % totalSlides;
            showSlide(nextIndex);
        }
        
        // Função para slide anterior
        function prevSlide() {
            const prevIndex = (currentSlide - 1 + totalSlides) % totalSlides;
            showSlide(prevIndex);
        }
        
        // Event listeners para os botões
        nextBtn.addEventListener('click', nextSlide);
        prevBtn.addEventListener('click', prevSlide);
        
        // Inicializar com o primeiro slide
        showSlide(0);
        
        console.log('✅ Carousel de infográficos inicializado com sucesso!');
    }

    /**
     * Inicializa o gráfico de doações acumuladas
     */
    async function initializeChart() {
        console.log('📊 Inicializando gráfico de doações...');
        
        try {
            // Buscar dados da tabela zc_vw_acum_doacoes
            const { data: chartData, error } = await _supabase
                .from('zc_vw_acum_doacoes')
                .select('ano, total_ano, acumulado')
                .order('ano', { ascending: true });
        
      if (error) {
                console.error('❌ Erro ao carregar dados do gráfico:', error);
        return;
      }
        
            if (!chartData || chartData.length === 0) {
                console.log('⚠️ Nenhum dado encontrado para o gráfico');
          return;
        }
        
            console.log(`✅ ${chartData.length} registros carregados para o gráfico`);
            
            // Preparar dados para o Chart.js
            const labels = chartData.map(item => item.ano.toString());
            const acumuladoData = chartData.map(item => item.acumulado);
            const totalAnoData = chartData.map(item => item.total_ano);
            
            // Criar gráfico
            const ctx = document.getElementById('donationsChart');
            if (!ctx) {
                console.log('⚠️ Canvas do gráfico não encontrado');
                return;
            }

      // Destruir gráfico anterior se existir
            if (window.donationsChartInstance) {
                window.donationsChartInstance.destroy();
            }
            
            // Marcos históricos das primeiras doações
            const historicalMilestones = [
                { year: 1979, country: 'Brasil', city: 'Birigui, São Paulo', description: 'Primeira doação da Central Geral do Dízimo' },
                { year: 1997, country: 'Argentina', description: 'Primeira doação da CD Argentina' },
                { year: 2007, country: 'Itália', description: 'Primeira doação da CD Itália' },
                { year: 2011, country: 'Bolívia', description: 'Primeira doação da CD Bolívia' },
                { year: 2016, country: 'Chile', description: 'Primeira doação da CD Chile' },
                { year: 2023, country: 'Portugal', description: 'Primeira doação da CD Portugal' }
            ];

            // Encontrar dados correspondentes aos marcos históricos
            const milestoneData = historicalMilestones.map(milestone => {
                const dataPoint = chartData.find(item => item.ano === milestone.year);
                return {
                    x: milestone.year, // Usar número, não string
                    y: dataPoint ? dataPoint.acumulado : 0,
                    milestone: milestone
                };
            });

            window.donationsChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
                    labels: labels,
          datasets: [{
                        label: 'Doações Acumuladas',
                        data: acumuladoData,
                        borderColor: '#B29637',
                        backgroundColor: 'rgba(178, 150, 55, 0.1)',
            borderWidth: 3,
            fill: true,
                tension: 0.4,
                        pointBackgroundColor: '#B29637',
                        pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6,
                        pointHoverRadius: 8,
                        pointHoverBackgroundColor: '#B29637',
                        pointHoverBorderColor: '#ffffff',
                        pointHoverBorderWidth: 3
                    }]
        },
        options: {
          responsive: true,
              maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 0,
                            right: 0,
                            top: 0,
                            bottom: 0
                        }
                    },
          plugins: {
                        legend: {
                            display: false
                        },
                tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#B29637',
                            borderWidth: 2,
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 12
                            },
                            callbacks: {
                                title: function(context) {
                                    return `Ano: ${context[0].label}`;
                                },
                                label: function(context) {
                                    const index = context.dataIndex;
                                    const totalAno = totalAnoData[index];
                                    const acumulado = context.parsed.y;
                                    return [
                                        `Total do Ano: ${totalAno.toLocaleString('pt-BR')}`,
                                        `Acumulado: ${acumulado.toLocaleString('pt-BR')}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                x: { 
                            type: 'linear',
                            position: 'bottom',
                            display: true,
                            min: 1979,
                            max: 2025,
                  title: { 
                    display: true, 
                                text: 'Anos',
                                color: '#042945',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                  },
                  grid: {
                                display: false
                  },
                            ticks: {
                                color: '#042945',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                stepSize: 1,
                                callback: function(value) {
                                    // Não mostrar anos no eixo X (já aparecem nas linhas verticais)
                                    return '';
                                }
                            }
                },
                y: { 
                            beginAtZero: true,
                            max: 14000,
                  title: { 
                    display: true, 
                                text: '',
                                color: '#042945',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                  grid: {
                                color: 'rgba(178, 150, 55, 0.2)',
                                lineWidth: 1
                  },
                  ticks: {
                                color: '#042945',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                    callback: function(value) {
                                    return value.toLocaleString('pt-BR');
                    }
                            },
                            position: 'left'
                }
              },
              interaction: {
                intersect: false,
                mode: 'index'
              },
              elements: {
                point: {
                            hoverBackgroundColor: '#B29637'
                }
          }
        }
            });
            
            // Adicionar plugin personalizado para linhas verticais
            Chart.register({
                id: 'milestoneLines',
                afterDraw: function(chart) {
                    const ctx = chart.ctx;
                    const xAxis = chart.scales.x;
                    const yAxis = chart.scales.y;
                    
                    // Marcos históricos
                    const milestones = [1979, 1997, 2007, 2011, 2016, 2023];
                    
                    // Descriptions dos marcos históricos
                    const milestoneDescriptions = {
                        1979: 'Primeira doação da Central Geral do Dízimo na cidade de Birigui, em São Paulo (Brasil)',
                        1997: 'Primeira doação da CD Argentina',
                        2007: 'Primeira doação da CD Itália',
                        2011: 'Primeira doação da CD Bolívia',
                        2016: 'Primeira doação da CD Chile',
                        2023: 'Primeira doação da CD Portugal'
                    };
                    
                            milestones.forEach((year, index) => {
                                // Calcular posição X exata do ano
                                const xPos = xAxis.getPixelForValue(year);
                                
                                // Verificar se a posição é válida
                                if (xPos >= xAxis.left && xPos <= xAxis.right) {
                                    // Linha vertical cinza contínua
                                    ctx.save();
                                    ctx.strokeStyle = '#6c757d';
                                    ctx.lineWidth = 1;
                                    ctx.setLineDash([]);
                                    ctx.beginPath();
                                    ctx.moveTo(xPos, yAxis.top);
                                    ctx.lineTo(xPos, yAxis.bottom);
                                    ctx.stroke();
                                    ctx.restore();
                                    
                                    // Texto do ano (centralizado na linha)
                                    ctx.save();
                                    ctx.fillStyle = '#042945';
                                    ctx.font = 'bold 12px Arial';
                                    ctx.textAlign = 'center';
                                    ctx.fillText(year.toString(), xPos, yAxis.bottom + 20);
                                    ctx.restore();
                                    
                                    // Posicionamento em escada para descrições (subindo)
                                    const baseY = yAxis.top + 20;
                                    const stepHeight = 30;
                                    // Inverter a ordem: anos mais recentes ficam mais altos
                                    const reverseIndex = milestones.length - 1 - index;
                                    const descriptionY = baseY + (reverseIndex * stepHeight);
                                    
                                    // Descrição do marco (à esquerda da linha)
                                    ctx.save();
                                    ctx.fillStyle = '#495057';
                                    ctx.font = '12px Arial';
                                    ctx.textAlign = 'right';
                                    const description = milestoneDescriptions[year];
                                    
                                    // Quebrar texto em linhas
                                    const words = description.split(' ');
                                    const lines = [];
                                    let currentLine = '';
                                    
                                    words.forEach(word => {
                                        const testLine = currentLine + (currentLine ? ' ' : '') + word;
                                        const metrics = ctx.measureText(testLine);
                                        if (metrics.width > 120) {
                                            lines.push(currentLine);
                                            currentLine = word;
                                        } else {
                                            currentLine = testLine;
                                        }
                                    });
                                    if (currentLine) lines.push(currentLine);
                                    
                                    // Desenhar cada linha - Birigui (1979) à direita, outros à esquerda
                                    let textX;
                                    if (year === 1979) {
                                        textX = xPos + 10; // 10px à direita da linha para Birigui
                                        ctx.textAlign = 'left';
                                    } else {
                                        textX = xPos - 10; // 10px à esquerda da linha para outros
                                        ctx.textAlign = 'right';
                                    }
                                    
                                    lines.forEach((line, lineIndex) => {
                                        const lineY = descriptionY + (lineIndex * 14);
                                        ctx.fillText(line, textX, lineY);
                                    });
                                    ctx.restore();
                                }
                            });
                }
            });
            
            console.log('✅ Gráfico de doações inicializado com sucesso!');
      
      } catch (error) {
            console.error('❌ Erro ao inicializar gráfico:', error);
        }
    }


    /* =========================================================================
        NAVEGAÇÃO E MODOS DE VISUALIZAÇÃO
    ========================================================================= */
    
    function switchMode(activeMode) {
        console.log(`Switching to mode: ${activeMode}`);
        
        // Se a camada do país existir e o novo modo NÃO for 'escolas', remova-a.
        if (countryLayer && activeMode !== 'schools') {
            map.removeLayer(countryLayer);
            countryLayer = null; // Limpa a variável
        }
        
        const modes = ['donations', 'schools', 'infographics', 'chart'];
        document.getElementById('sidebarLeft').style.display = (activeMode === 'donations' || activeMode === 'schools') ? 'flex' : 'none';
        document.getElementById('map').style.display = (activeMode === 'donations' || activeMode === 'schools') ? 'block' : 'none';
        document.getElementById('infographicsContainer').style.display = activeMode === 'infographics' ? 'flex' : 'none';
        document.getElementById('chartContainer').style.display = activeMode === 'chart' ? 'block' : 'none';
        document.getElementById('donationsSidebar').style.display = activeMode === 'donations' ? 'block' : 'none';
        document.getElementById('schoolsSidebar').style.display = activeMode === 'schools' ? 'block' : 'none';
        
        modes.forEach(mode => {
            const btn = document.getElementById(`${mode}Btn`);
            if (btn) btn.classList.toggle('active', mode === activeMode);
        });
        
        const sidebarRight = document.getElementById('sidebarRight');
        if (activeMode === 'schools') {
            sidebarRight.style.display = 'block';
            document.getElementById('donationsDetails').style.display = 'none';
            document.getElementById('schoolDetails').style.display = 'block';
            initSchoolsMode();
      } else {
            sidebarRight.style.display = 'none';
        }

        if (activeMode === 'donations') {
            loadCentralsPins();
            // Carregar destaque dos países (sempre visível, independente dos filtros)
            loadCountriesHighlight();
        } else {
            // Remover layer dos países quando sair do modo donations
            if (countriesLayer) {
                map.removeLayer(countriesLayer);
                countriesLayer = null;
            }
        }
        
        map.invalidateSize();
    }
    
    const schoolsData = {
       escolas: [
         { nome: "RAFARD", ano_inauguracao: 1998, qtd_por_ano: 1200, endereco: "Rafard /SP", lat: -23.010500, lng: -47.531800, imagem: "rafard.jpg" },
         { nome: "RIBEIRÃO PRETO", ano_inauguracao: 2000, qtd_por_ano: 900, endereco: "Ribeirão Preto /SP", lat: -21.142180, lng: -47.851380, imagem: "ribeirao-preto.jpg" },
         { nome: "CUIABÁ", ano_inauguracao: 2001, qtd_por_ano: 2000, endereco: "Cuiabá /MT", lat: -15.601000, lng: -56.097400, imagem: "cuiaba.jpg" },
         { nome: "PARÁ DE MINAS", ano_inauguracao: 2003, qtd_por_ano: 430, endereco: "Pará de Minas /MG", lat: -19.853400, lng: -44.611400, imagem: "para-de-minas.jpg" },
         { nome: "CAPÃO BONITO", ano_inauguracao: 2005, qtd_por_ano: 1300, endereco: "Capão Bonito /SP", lat: -24.028580, lng: -48.356580, imagem: "capao-bonito.jpg" },
         { nome: "SUMARÉ", ano_inauguracao: 2007, qtd_por_ano: 1800, endereco: "Sumaré /SP", lat: -22.820400, lng: -47.272800, imagem: "sumare.jpg" },
         { nome: "BACCARELLI", ano_inauguracao: 2008, qtd_por_ano: 240, endereco: "São Paulo /SP (Heliópolis)", lat: -23.618478, lng: -46.592606, imagem: "baccarelli.jpg" },
         { nome: "GOIÂNIA", ano_inauguracao: 2011, qtd_por_ano: 1000, endereco: "Aparecida de Goiânia /GO", lat: -16.819800, lng: -49.246900, imagem: "goiania.jpg" },
         { nome: "CAMPO GRANDE", ano_inauguracao: 2013, qtd_por_ano: 7000, endereco: "Campo Grande /MS", lat: -20.448600, lng: -54.629500, imagem: "campo-grande.jpg" },
         { nome: "UBERLÂNDIA", ano_inauguracao: 2014, qtd_por_ano: 2000, endereco: "Uberlândia /MG", lat: -18.914100, lng: -48.274900, imagem: "uberlandia.jpg" },
         { nome: "GUARULHOS", ano_inauguracao: 2015, qtd_por_ano: 20000, endereco: "Guarulhos /SP", lat: -23.435010, lng: -46.433224, imagem: "guarulhus.jpg" },
         { nome: "PINDA", ano_inauguracao: 2017, qtd_por_ano: 8000, endereco: "Pindamonhangaba /SP", lat: -22.924600, lng: -45.461300, imagem: "pinda.jpg" },
         { nome: "CURITIBA", ano_inauguracao: 2018, qtd_por_ano: 5000, endereco: "Curitiba /PR", lat: -25.420631, lng: -49.281118, imagem: "curitiba.jpg" },
         { nome: "BOM RETIRO", ano_inauguracao: 2021, qtd_por_ano: 1100, endereco: "São Paulo /SP (Bom Retiro)", lat: -23.522450, lng: -46.646052, imagem: "bom-retiro.jpg" },
         { nome: "LONDRINA", ano_inauguracao: 2024, qtd_por_ano: 4300, endereco: "Londrina /PR", lat: -23.304000, lng: -51.169100, imagem: "londrina.jpg" }
       ]
     };

     function initSchoolsMode() {
         const schoolsList = document.getElementById('schoolsList');
         schoolsList.innerHTML = '';
         document.getElementById('totalEscolas').textContent = schoolsData.escolas.length;
         
         markersLayer.clearLayers();
         
         addBrazilHighlightLayer();

         schoolsData.escolas.forEach(school => {
             const item = document.createElement('div');
             item.className = 'school-list-item';
             item.innerHTML = `<div class="school-name">${school.nome}</div> <div class="school-year">${school.ano_inauguracao}</div>`;
             item.onclick = () => {
                 map.flyTo([school.lat, school.lng], 15);
                 showSchoolDetails(school);
             };
             schoolsList.appendChild(item);

            // Criar ícone personalizado para escolas (dourado)
            const schoolIcon = L.divIcon({
                className: 'custom-marker school-marker',
                html: '<div class="marker-pin school-pin"></div>',
                iconSize: [25, 25],
                iconAnchor: [12, 12]
            });

            L.marker([school.lat, school.lng], { icon: schoolIcon }).addTo(markersLayer)
              .bindPopup(`<b>${school.nome}</b><br>${school.endereco}`)
              .on('click', function() {
                map.flyTo([school.lat, school.lng], 15);
                showSchoolDetails(school);
              });
         });
         map.flyTo([-15.78, -47.92], 4.5);
     }

    /**
     * Adiciona uma camada de destaque para o Brasil usando um GeoJSON mundial.
     * Pinta apenas o Brasil e deixa os outros países transparentes.
     */
    function addBrazilHighlightLayer() {
        if (countryLayer) {
            map.removeLayer(countryLayer);
        }
        const worldGeoJsonUrl = 'https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json';
        fetch(worldGeoJsonUrl)
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return response.json();
            })
            .then(worldData => {
                countryLayer = L.geoJSON(worldData, {
                    style: feature => {
                        if (feature.properties.name === 'Brazil') {
                            return {
                                color: '#A18547',
                                weight: 3,
                                opacity: 0.8,
                                fillColor: '#A18547',
                                fillOpacity: 0.2
                            };
      } else {
                            return {
                                fillOpacity: 0,
                                weight: 0,
                                color: 'transparent'
                            };
                        }
                    }
                }).addTo(map);
            })
            .catch(error => {
                console.error("❌ Falha ao carregar a camada de países:", error);
            });
    }

     function showSchoolDetails(school) {
         const sidebarRight = document.getElementById('sidebarRight');
         const schoolDetails = document.getElementById('schoolDetails');
         const donationsDetails = document.getElementById('donationsDetails');
         if (sidebarRight && schoolDetails && donationsDetails) {
             donationsDetails.style.display = 'none';
             schoolDetails.style.display = 'block';
             sidebarRight.style.display = 'block';
             const selectedSchoolInfo = document.getElementById('selectedSchoolInfo');
             if (selectedSchoolInfo) {
                 selectedSchoolInfo.innerHTML = `<div class="school-details-header"><h2>Detalhes da Escola</h2><button class="school-details-close" onclick="closeSchoolDetails()">×</button></div><img src="images/${school.imagem}" alt="${school.nome}" class="school-details-image" onerror="this.style.display='none'"><div class="school-details-content"><h3 class="school-details-title">${school.nome}</h3><div class="school-details-info"><i class="fas fa-calendar-alt"></i><span>Inaugurada em: ${school.ano_inauguracao}</span></div><div class="school-details-info"><i class="fas fa-map-marker-alt"></i><span>${school.endereco}</span></div><div class="school-details-info"><i class="fas fa-users"></i><span>Capacidade: ${school.qtd_por_ano.toLocaleString('pt-BR')} alunos/ano</span></div><div class="school-details-capacity"><i class="fas fa-graduation-cap"></i>Escola Profissionalizante</div></div>`;
             }
         }
     }

     function closeSchoolDetails() {
         const sidebarRight = document.getElementById('sidebarRight');
         if (sidebarRight) {
             sidebarRight.style.display = 'none';
         }
     }

     function closeHamburgerMenu() {
      const hamburgerBtn = document.getElementById('hamburgerBtn');
         const hamburgerDropdown = document.getElementById('hamburgerDropdown');
         if (hamburgerBtn && hamburgerDropdown) {
      hamburgerBtn.classList.remove('active');
             hamburgerDropdown.classList.remove('show');
         }
     }

    async function initializeApp() {
        console.log("✨ Inicializando aplicação...");
        
        // Mostrar modal de carregamento
        document.getElementById('loadingModal').style.display = 'flex';
        
        // Event listeners para modais
        document.getElementById('closeInstructionBtn').addEventListener('click', () => {
            document.getElementById('instructionModal').style.display = 'none';
        });
        
        // Modal de instruções
        document.getElementById('howToNavigateBtn').addEventListener('click', () => {
            document.getElementById('instructionsModal').classList.add('show');
        });
        
        document.getElementById('closeInstructionsBtn').addEventListener('click', () => {
            document.getElementById('instructionsModal').classList.remove('show');
        });
         document.getElementById('hamburgerBtn').addEventListener('click', function() {
             document.getElementById('hamburgerDropdown').classList.toggle('show');
             this.classList.toggle('active');
         });
         document.getElementById('donationsBtn').addEventListener('click', () => {
             switchMode('donations');
             closeHamburgerMenu();
         });
         document.getElementById('schoolsBtn').addEventListener('click', () => {
             switchMode('schools');
             closeHamburgerMenu();
         });
         document.getElementById('infographicsBtn').addEventListener('click', () => {
             switchMode('infographics');
             closeHamburgerMenu();
         });
         document.getElementById('chartBtn').addEventListener('click', () => {
             switchMode('chart');
             closeHamburgerMenu();
         });
         document.getElementById('clearFiltersBtn').addEventListener('click', clearFilters);
         document.getElementById('dropdownCentral').addEventListener('change', applyAndRefreshFilters);
         document.getElementById('dropdownCidade').addEventListener('change', applyAndRefreshFilters);
         document.getElementById('dropdownPais').addEventListener('change', applyAndRefreshFilters);
         document.getElementById('dropdownAno').addEventListener('change', applyAndRefreshFilters);
         const viewDataTableBtn = document.getElementById('viewDataTableBtn');
         if (viewDataTableBtn) {
             viewDataTableBtn.addEventListener('click', (e) => {
                 e.preventDefault();
                 openFullscreenList();
             });
         }
         const closeFullscreenListBtn = document.getElementById('closeFullscreenListBtn');
         if (closeFullscreenListBtn) {
             closeFullscreenListBtn.addEventListener('click', closeFullscreenList);
         }
        initializeSearchFilters();
        await applyAndRefreshFilters();
        
        // Carregar destaque dos países na primeira vez (modo donations)
        loadCountriesHighlight();
        
        // Inicializar carousel de infográficos
        initializeCarousel();
        
        // Inicializar gráfico
        initializeChart();
        
        // Esconder modal de carregamento após carregar tudo
        setTimeout(() => {
            document.getElementById('loadingModal').style.display = 'none';
        }, 2000); // 2 segundos para mostrar o carregamento
    }

     document.addEventListener('DOMContentLoaded', initializeApp);

  </script>
</body>
</html>
